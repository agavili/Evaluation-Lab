---
title: "Evaluation-Lab"
author: "Anna Stein"
date: "10/27/2021"
output: html_document
---

Need to use 2 datasets. 



```{r}
# load in needed packages
install.packages("class")  
library(tidyverse)
library(caret)
library(RColorBrewer)
library(ROCR)
#install.packages("MLmetrics")
library(MLmetrics)
library(class)
```

```{r}
# read in data
music_data = read.csv("/Users/Anna/Downloads/data.csv")
```


```{r}
# taking out NAs
table(is.na(music_data)) # from this, it seems that there aren't NAs in this dataframe 
music_data <- music_data[complete.cases(music_data), ] # take out rows that contain NAs
View(music_data) # looks like that didn't make a difference


# taking out unecessary columns: column titled 'X', column titled 'target'
music_data = music_data[,-c(1,15)] # don't run this more than once 
View(music_data)


# check variable classes, and change if necessary: 
str(music_data)
# classes seem to be correct, don't need changing

class(music_data$time_signature)
music_data$time_signature = as.character(music_data$time_signature)
class(music_data$time_signature)


numvar_inmusic = names(select_if(music_data, is.numeric))
#View(numvar_inmusic)
# this gives us a table with the columns that are numeric

# scale the numeric variables
music_data[numvar_inmusic] = lapply(music_data[numvar_inmusic], scale)


# normalize numeric variables 
# building a normalizer: 
normalize <- function(x){
 (x - min(x)) / (max(x) - min(x))
}



music_data[numvar_inmusic] = lapply(music_data[numvar_inmusic], normalize)
View(music_data)
# now, all numeric variables are normalized 
```

Need to define a question that can be answered using kNN. 
we could have different categories of danceability -- low danceability, medium, and high. 
then, the kNN model would classify whether a song is low, medium, or high in terms of danceability. 
We could also use binary classification -- low or high danceability. 


Split up dataframe into Training and Testing:  
```{r}
#music_data has 2,017 rows 
# we want to take 80% of these rows (so, eventually, 80% of the dataframe) and put them into our Training set
# the remaining 20% of rows will be for Testing 


set.seed(200)
music_data_train_rows = sample(1:nrow(music_data), # look at all the rows in music_data
                              round(0.8 * nrow(music_data), 0),  #<- multiply the 
                                                                #   number of rows
                                                                #   by 0.8 and round
                                                                #   the decimals
                              replace = FALSE)#<- don't replace the numbers

View(music_data_train_rows)

music_data_train = music_data[music_data_train_rows, ] # select all columns, and 80% of the rows 

# now we need our testing set: 
music_data_test = music_data[-music_data_train_rows, ] # all columns, and the rows that weren't selected as part of the training data
View(music_data_test) # we have 20% of the original dataframe here
```



Need to make danceability into a binary variable? 
```{r}
# need to cut at a certain value for danceability
fivenum(music_data$danceability)
# the median is around 0.6 for danceability, so lets cut there. if danceability is above a 0.6, the song is highly danceable. Otherwise, the song has a low level of danceability. 
music_data$danceability <- cut(music_data$danceability,c(-1,0.6,1),labels = c(0,1))
View(music_data)
# now we have danceability as a binary variable 
```





Training the classifer: 
```{r}
set.seed(200)
music_7NN<-  knn(train = music_data_train[, c("acousticness", "energy", "instrumentalness","liveliness","tempo")],#<- training set cases # the variables we want to look at OTHER than danceability (i'm pretty sure)
               test = music_data_test[, c("acousticness", "energy", "instrumentalness","liveliness","tempo")],    #<- test set cases
               cl = music_data_train[, "danceability"],#<- category for true classification # this would be danceability????
               k = 7,#<- number of neighbors considered
               use.all = TRUE,
               prob = TRUE) #<- control ties between class assignments If true, all distances equal to the kth largest are included

```


